<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Delia's Infinity Adventure</title>
    <style>
        body { margin: 0; overflow: hidden; background: #fdf2f8; font-family: 'Comic Sans MS', cursive; touch-action: manipulation; }
        #hud { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; z-index: 100; }
        .bubble { background: white; padding: 10px 15px; border-radius: 20px; border: 3px solid #db2777; font-size: 14px; color: #db2777; font-weight: bold; }
        #character { position: absolute; font-size: 60px; z-index: 50; transition: all 0.6s ease-out; pointer-events: none; }
        
        .game-object { position: absolute; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        /* SHAPES FIX */
        .shape-circle { width: 60px; height: 60px; border-radius: 50%; border: 4px solid white; }
        .shape-square { width: 60px; height: 60px; border: 4px solid white; }
        .shape-triangle { 
            width: 0; height: 0; 
            border-left: 35px solid transparent; 
            border-right: 35px solid transparent; 
            border-bottom: 60px solid #db2777; 
        }

        #math-screen { position: fixed; inset: 0; background: rgba(219, 39, 119, 0.98); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; color: white; }
        .math-btn { background: white; color: #db2777; border: none; padding: 15px 30px; font-size: 25px; border-radius: 15px; margin: 10px; font-weight: bold; }
        #start-screen { position: fixed; inset: 0; background: #db2777; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
    </style>
</head>
<body>

<audio id="snd-success" src="child-says-yes-113117.mp3"></audio>
<audio id="snd-error" src="no-no-no-242246.mp3"></audio>

<div id="start-screen">
    <h1>üå∏ DELIA'S WORLD üå∏</h1>
    <button class="math-btn" onclick="startGame()">START ‚ú®</button>
</div>

<div id="math-screen">
    <h2 id="math-q" style="font-size: 40px;">?</h2>
    <div id="math-opts"></div>
</div>

<div id="hud">
    <div class="bubble" id="lvl-txt">Level 1</div>
    <div class="bubble" id="task-txt">Find...</div>
    <div class="bubble" id="score-txt">‚≠ê 0</div>
</div>

<div id="character">üêù</div>

<script>
    let points = 0;
    const playerName = "Delia";
    let targetId = "";

    function speak(text) {
        const msg = new SpeechSynthesisUtterance();
        msg.text = text; msg.lang = 'en-US'; msg.rate = 0.8;
        window.speechSynthesis.speak(msg);
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        spawn();
    }

    function spawn() {
        document.querySelectorAll('.game-object').forEach(o => o.remove());
        
        if (points > 0 && points % 2 === 0 && !this.isMathDone) {
            showMathPopup();
            this.isMathDone = true;
            return;
        }
        this.isMathDone = false;

        let level = (Math.floor(points / 6) % 3) + 1; // Simplificat la 3 tipuri de nivele pentru claritate
        document.getElementById('lvl-txt').innerText = "Level " + level;

        if (level === 1) levelColors();
        else if (level === 2) levelShapes();
        else levelNumbers();
    }

    // --- GENERARE OBIECTE ---

    function levelColors() {
        const c = [{n:'red',h:'#ef4444'}, {n:'blue',h:'#3b82f6'}, {n:'green',h:'#22c55e'}, {n:'yellow',h:'#facc15'}];
        let t = c[Math.floor(Math.random()*c.length)];
        targetId = t.n;
        document.getElementById('task-txt').innerText = "Find: " + t.n;
        speak(playerName + ", find the " + t.n + " flower");

        c.forEach(color => {
            const el = createObj();
            const f = document.createElement('div'); f.className = 'shape-circle'; f.style.background = color.h;
            el.appendChild(f);
            el.onclick = () => check(color.n === targetId, el, color.n);
            document.body.appendChild(el);
        });
    }

    function levelShapes() {
        const s = [{n:'square',t:'square'},{n:'circle',t:'circle'},{n:'triangle',t:'triangle'}];
        let t = s[Math.floor(Math.random()*s.length)];
        targetId = t.n;
        document.getElementById('task-txt').innerText = "Find: " + t.n;
        speak(playerName + ", find the " + t.n);

        s.forEach(shape => {
            const el = createObj();
            const f = document.createElement('div'); 
            if(shape.t === 'triangle') {
                f.className = 'shape-triangle';
            } else {
                f.className = 'shape-' + shape.t; f.style.backgroundColor = "#db2777";
            }
            el.appendChild(f);
            el.onclick = () => check(shape.n === targetId, el, shape.n);
            document.body.appendChild(el);
        });
    }

    function levelNumbers() {
        let n = Math.floor(Math.random()*10);
        targetId = n.toString();
        document.getElementById('task-txt').innerText = "Find Number: " + n;
        speak(playerName + ", find number " + n);

        [n, (n+1)%10, (n+2)%10].forEach(num => {
            const el = createObj(); el.style.fontSize = "50px"; el.style.color = "#db2777"; el.innerText = num; el.style.fontWeight="bold";
            el.onclick = () => check(num.toString() === targetId, el, "number " + num);
            document.body.appendChild(el);
        });
    }

    function createObj() {
        const el = document.createElement('div'); el.className = 'game-object';
        // Pozi»õionare simplƒÉ fƒÉrƒÉ a for»õa non-overlap extrem care blocheazƒÉ desenarea
        el.style.left = (Math.random()*70 + 5) + '%'; 
        el.style.top = (Math.random()*60 + 20) + '%';
        return el;
    }

    function check(isCorrect, el, name) {
        if(isCorrect) {
            document.getElementById('snd-success').currentTime = 0; document.getElementById('snd-success').play();
            points++; document.getElementById('score-txt').innerText = "‚≠ê " + points;
            spawn();
        } else {
            document.getElementById('snd-error').currentTime = 0; document.getElementById('snd-error').play();
            speak("No, that is " + name);
        }
    }

    function showMathPopup() {
        const scr = document.getElementById('math-screen');
        const opts = document.getElementById('math-opts');
        opts.innerHTML = ""; scr.style.display = "flex";
        let a = Math.floor(Math.random()*5)+1, b = Math.floor(Math.random()*4)+1;
        let res = a + b;
        document.getElementById('math-q').innerText = `${a} + ${b} = ?`;
        speak(playerName + ", what is " + a + " plus " + b + "?");
        [res, res+1, res+2].sort(()=>Math.random()-0.5).forEach(n => {
            const btn = document.createElement('button'); btn.className = "math-btn"; btn.innerText = n;
            btn.onclick = () => {
                if(n === res) { document.getElementById('snd-success').play(); scr.style.display="none"; points++; spawn(); }
                else { document.getElementById('snd-error').play(); }
            };
            opts.appendChild(btn);
        });
    }
</script>
</body>
</html>
